<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="../../js/mui.js"></script>
		<link href="../../css/mui.css" rel="stylesheet" />
		<link rel="stylesheet" href="apply.css" />
		<link rel="stylesheet" href="../../css/share_main.css" />
		<style>
			html,body{
				height: 100%;
				width: 100%;
			}
			 .mui-table-view-cell .select_sex input{
				height: auto; 
				font-size: 14px; 
				width: 14px;
			}
			.select_sex label{
				color: silver;
			}
			.nation_mark {
				display: none;
				position: absolute;
				z-index: 998;
				background-color: rgba(0, 0, 0, .4);
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
			}
			.spplay_select_type{
				width: 80%;  
				position: absolute;
				z-index: 999;  
				left: 50%;
			    margin-left:-40%;
			    top: 50%;
			    text-align: center;
			    margin-top: -25%;
				overflow: hidden;
			} 
			.spplay_select_type .mui-table-view li{
				height: 48px;
				font-size: 14px;
				line-height: 48px;   
				color:  #5f5d5d;
				background-color: #EEE;
			}
			.nation_select{
				width: 70%;
				height: 80%;
				z-index: 999;
				overflow-y: scroll;
				top: 10%;
				left: 50%;
				margin-left: -35%;
				position: absolute;
				display: none;
			} 		
			.nation_select .mui-table-view li{
				color:  #5f5d5d;
				background-color: #EEE;
			}
			input[disabled]{
				opacity: 1;
				color: #5f5d5d !important; 
			}
			.mui-table-view .mui-table-cell span,label{
				color: #5f5d5d;
			}
			/*.mui-scroll-wrapper .mui-scroll{
				height: 100%; 
			}*/
		</style>
	</head>

	<body>
		<!--国籍列表-->
		<div class="nation_mark"></div>
		<div class="nation_select " id='nation_select_'>
			 <ul class="mui-table-view">
			 	<li class="mui-table-view-cell">中国</li>
			 	<li class="mui-table-view-cell">美国</li>
			 	<li class="mui-table-view-cell">日本</li>
			 	<li class="mui-table-view-cell">韩国</li>
			 	<li class="mui-table-view-cell">朝鲜</li>
			 	<li class="mui-table-view-cell">德国</li>
			 	<li class="mui-table-view-cell">英国</li>
			 	<li class="mui-table-view-cell">法国</li>
			 	<li class="mui-table-view-cell">瑞士</li>
			 	<li class="mui-table-view-cell">美国</li>
			 	<li class="mui-table-view-cell">加拿大</li>
			 	<li class="mui-table-view-cell">意大利</li>
			 	<li class="mui-table-view-cell">柬埔寨</li>
			 	<li class="mui-table-view-cell">老挝</li>
			 	<li class="mui-table-view-cell">泰国</li>
			 	<li class="mui-table-view-cell">俄罗斯</li>
			 	<li class="mui-table-view-cell">澳大利亚</li>
			 	<li class="mui-table-view-cell">巴基斯坦</li>
			 	<li class="mui-table-view-cell">以色列</li>
			 	<li class="mui-table-view-cell">缅甸</li>
			 	<li class="mui-table-view-cell">蒙古</li>
			 	<li class="mui-table-view-cell">牙买加</li>
			 	<li class="mui-table-view-cell">印度</li>
			 	<li class="mui-table-view-cell">非洲</li>
			 	<li class="mui-table-view-cell">匈牙利</li>
			 	<li class="mui-table-view-cell">奥地利</li>
			 	<li class="mui-table-view-cell">瑞士</li>
			 </ul>  
		</div>
		<!--证件选择-->
		<div class="spplay_select_type mui-popover" id="id_type" >
			<ul class="mui-table-view">
				<li class="mui-table-view-cell mui-text-left">学生证</li>
				<li class="mui-table-view-cell mui-text-left">身份证</li>
				<li class="mui-table-view-cell mui-text-left">残疾证</li>
				<li class="mui-table-view-cell mui-text-left">军人证</li>
				<li class="mui-table-view-cell mui-text-left">驾驶证</li>
			</ul>
		</div>
		<header class="mui-bar mui-bar-nav nav_header ">
			<img src="../../img/left.png" alt="" class="header_left_img mui-action-back" />
			<span>Application For Deliverer</span>
		</header>
		<footer class="mui-bar mui-bar-footer content_chan" id="footer" >  
			<button class="mui-btn nav_footer" id="apply_submit"><span>Next Step</span></button>
		</footer>
		<div id="loading-mask" ></div>
		<div id="loading-box">  
			<img src="../../img/loading2.gif" alt="loading" width="100%"/>
		</div>
			<div class="presee mui-hidden">
			<div class="picwraps"> 
				<div class="mui-slider" id="slider">
					<div class="mui-slider-group" id="preseepic">
						<div class="mui-slider-item" >
							<a href="javascript:void(0)">
								<img src="" class="preimg pic_one">
							</a>
						</div>
						<div class="mui-slider-item">
							<a href="javascript:void(0)">
								<img src="" class="preimg pic_two_">  
							</a>
						</div>
						<div class="mui-slider-item">
							<a href="javascript:void(0)">
								<img src="" class="preimg pic_three">
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="mui-content apply_content">
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll" >
					<ul class="mui-table-view ">
						<li class="mui-table-view-divider  title_  mui-text-center info mui-hidden" id="title_apply">
							<div class="bell_title">
								<span><img src="../../img/title_bell.png" alt="" /></span> 
								<span id="status_info" >dsadas</span>
							</div>
						</li>
						<li class="mui-table-view-divider"> <span>Basic Information</span></li>
						<li class="mui-table-view-cell">
							<img src="../../img/first-name.png" class=" li_left_img" alt="" />
							<div class="li_input_l">
								<input type="text" class="apply_input edit" placeholder="familyName" id="familyName"/> 
							</div>
						</li>
						  
						<li class="mui-table-view-cell">
							<img src="../../img/lastname.png" class="li_left_img" alt="" />
							<div class="li_input_l">
								<input type="text" class="apply_input edit" placeholder="firstName" id="firsetName" />
							</div>
						</li>
						<li class="mui-table-view-cell">
							<img src="../../img/gender.png" class="li_left_img " alt="" />
							<span class="mui-hidden two"><span class="mui-pull-left" >female</span><img src="../../img/female2.png" class="li_left_img  "/></span>
							<span class="mui-hidden  one"><span class="mui-pull-left" >male</span><img src="../../img/male2.png" alt="" class="li_left_img "/></span>
							<div class="li_input_l select_sex"> 
								<span class="content_chan">
									<lable >man </lable>
									<input type="radio" name="sex" value="man" checked="checked" id="person_sex" />
									&nbsp;&nbsp;<lable >women </lable>
									<input  type="radio" name="sex" />
									
								</span>
							</div>
						</li>
						<li class="mui-table-view-cell" >
							<img src="../../img/nationality2.png" class="li_left_img" alt="" />
							<div class="li_input_l" >
								<input type="text" placeholder="select nation "  class="edit apply_nation" id="nation" readonly="readonly"/>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<img src="../../img/address.png" class="li_left_img" alt="" />
							<div class="li_input_l">
								<input type="text" class="apply_input edit" placeholder="place of residence" id="apply_place" />
							</div>
						</li>
						<li class="mui-table-view-cell ">
							<img src="../../img/emergency2.png" class="li_left_img" alt="" />
							<img src="../../img/contact2.png" id="choose-contacts" class="li_right_img" alt="" />
							<div class="li_input_s">
								<input type="text" class="apply_input edit" placeholder="emergency contact " id="apply_emergencyC" />
							</div>
						</li>
						<li class="mui-table-view-cell">
							<img src="../../img/pho2.png" class="li_left_img" alt="" />
							<div class="li_input_l">
								<input type="number" class="apply_input edit" placeholder="mobile" id="apply_mobile" />
							</div>
						</li>
						<li class="mui-table-view-cell">
							<img src="../../img/credit.png" class=" li_left_img" alt="" />
							<div class="li_input_l">
								<input type="number" class="apply_input edit" placeholder="identity" id="identity" >
							</div>
						</li>
						<li class="mui-table-view-cell" id="select_type">
							<img src="../../img/id2.png" class=" li_left_img" alt="" />
							<img src="../../img/down.png" class=" li_right_img content_chan" alt="" />
							<div class="li_input_s">
								<input type="text" class="apply_input edit" placeholder="请选择证件" readonly="readonly" id="select_type_show" />
							</div>
						</li>
						
						<li class="mui-table-view-cell" style="">
							<img src="../../img/EDIT22.png" class=" li_left_img" alt="" />
							<div class="li_input_l">
								<input type="number" class="apply_input edit" placeholder="请输入对应的证件号" id="id_number"  />
							</div>
						</li>
					</ul>
					<div class="clear_padd mui-hidden info " id="porel">
						<img src="" class="mui-pull-left" id="pic_one"/>
						<img src="" class="pic_two " id="pic_two" />
						<img src="" class="mui-pull-right" id="pic_three" />
					</div>
				</div>
			</div>
		</div>
		
	</body>
	<script src="../../js/jquery.min.js"></script>
	<script src="../../js/utils.js"></script>
	<script>
		mui.plusReady(function() {
			plus.webview.currentWebview().setStyle({
				scrollIndicator: 'none'
			});
			mui('.mui-scroll-wrapper').scroll({
				bounce : false,
			});
			var flag = true;
			$('#apply_submit').on('tap',function(){
				check_info();
			}) 
			function check_info() { //检测填写情况
				var v_fam = $('#firsetName').val().trim();
				var v_fir = $('#familyName').val().trim();
				var v_nation = $('#nation').val();
				var v_address = $('#apply_place').val().trim();
				var v_emer = $('#apply_emergencyC').val().trim();
				var v_mo = $('#apply_mobile').val().trim();
				var v_idtT=$('#select_type_show').val().trim();
					plus.storage.setItem('id_type',v_idtT);
				var v_identity = $('#identity').val().trim();
				var check = $('#person_sex').prop('checked');
				var sex = (check == true) ? '1' : '2';
				var id_nu = $('#id_number').val().trim();  
				var car_info_status = plus.storage.getItem('carInfoSta'); //得到carInfo的资料填写情况
				if (true) {
					if (!v_fam) {
						mui.toast('请填写你的名');
						flag = false;
						return;
					}
					if (!v_fir) {
						mui.toast('请填写你的姓');
						flag = false;
						return;
					}
					if (!v_nation) {
						mui.toast('请填写你的国籍');
						flag = false;
						return;
					}
					if (!v_address) {
						mui.toast('请填写你的地址');
						flag = false;
						return;
					}
					if (!v_emer) {
						mui.toast('请填写你的紧急联系人');
						flag = false;
						return;
					}
					if (!v_mo) {
						mui.toast('请填写你的急联系人电话号码');
						flag = false;
						return;
					}
					if (!v_identity) {
						mui.toast('请填写你的身份证号码');
						flag = false;
						return;
					}
					if (!v_idtT) {
						mui.toast('请先选择证件类型！');
						flag = false;
						return;
					}
					if (!id_nu) {
						mui.toast('请输入证件号码！');
						flag = false;
						return;
					}
				}
				if (flag) {
					data_first = {
						nation: v_nation,
						address: v_address,
						identity: v_identity,
						firstName: v_fir,
						familyName: v_fam,
						armPhone: v_mo,  
						armUser: v_emer,
						sex: sex,
						idType: v_idtT,
						creditCard: id_nu
					}
					plus.storage.setItem('nation_data1', JSON.stringify(data_first));
				}
				mui.toast('请完成下一步操作');
				openWindow("./idcard.html");
			}
			//证件类型
			$('#id_type ul li').on('tap',function(){
				 var id_type_name=$(this).text();
				 $('#select_type_show').val(id_type_name);
				 mui('#id_type').popover('toggle');
				
			})
			document.querySelector(".nation_mark").addEventListener("click", function() {
				$('.nation_mark').css('display', 'none');
				$('#nation_select_').css('display','none');
			})
			$('.apply_nation').on('click', function() {
				$('.nation_mark').css('display', 'block');
				$('#nation_select_').css('display', 'block');
			})
			$('#nation_select_ ul li').on('click', function() {
				var nation = $(this).text();
				$('#nation').val(nation);
				$('.nation_mark').css('display', 'none');
				$('#nation_select_').css('display', 'none');
			})
			$('#select_type').on('tap', function() {
				mui('#id_type').popover('toggle');
			})
			
			// 选择联系人button按钮
			document.getElementById("choose-contacts").addEventListener("tap", function(){
				openWindow("./choose-contact.html");
			})
			
			window.addEventListener("choose:contacts", function(eve){
				document.getElementById("apply_emergencyC").value = eve.detail.name;
				document.getElementById("apply_mobile").value = eve.detail.tel;
			})
			//info
			 var data='';
		   	  myAjax({url:'account/getDeliverInfo',data:data},function(obj){
		   	  	var status=obj.ret;
		   	  	if(status==11){
		   	  		$('#loading-mask').css('display','none');
		   	  		$('#loading-box').css('display','none');
		   	  	}else{
		   	  		$('.info').removeClass('mui-hidden');
		   	  		$('.edit').attr('readonly','readonly');
		   	  		$('.content_chan').css('display','none');  
		   	  		$('#nation').attr('disabled','disabled');
		   	  		$('#select_type_show').attr('disabled','disabled');
		   	  		$('#choose-contacts').css('display','none');
		   	  		if(status==1){
		   	  			$('#status_info').text('你的审核已成功');
		   	  			$(".mui-scroll-wrapper").css("bottom", 0)
		   	  		}else if(status==12){
		   	  			$(".mui-scroll-wrapper").css("bottom",0)
		   	  			$('#status_info').text('你的审核还在审核中');
		   	  		}else if(status==13){
		   	  			$('#status_info').text('审核失败,请点击重新申请');
		   	  			$('#title_apply').addClass('applyPerson');
		   	  		}
		   	  		$("#footer").css("display", "none");
		   	  		$('#loading-mask').css('display','none');
		   	  		$('#loading-box').css('display','none');
		   	  	}
		   	  		
		   	  	var res=obj.res;
		   	  	if(JSON.stringify(res)){
		   	  		$('#familyName').val(res.familyName);
		   	  		$('#firsetName').val(res.firstName);
		   	  		$('#nation').val(res.nation);
		   	  		$('#apply_place').val(res.address);
		   	  		$('#select_type_show').val(res.idType); 
		   	  		$('#identity').val(res.identity);
		   	  		$('#apply_emergencyC').val(res.armUser);
		   	  		$('#apply_mobile').val(res.armPhone); 
		   	  		$('#id_number').val(res.creditCard);
		   	  		var n=BASEURL.indexOf('/a');
		   	  		var path=BASEURL.substring(0,n);
		   	  		$('.pic_one').attr('src',path+res.cardPic1.minPath);
		   	  		$('.pic_two_').attr('src',path+res.cardPic2.minPath);
		   	  		$('.pic_three').attr('src',path+res.cardPic3.minPath);
		   	  		$('#pic_one').attr('src',path+res.cardPic1.path);
		   	  		$('#pic_two').attr('src',path+res.cardPic2.path);
		   	  		$('#pic_three').attr('src',path+res.cardPic3.path);  
		   	  		if(res.sex==1){
		   	  			$('.two').removeClass('mui-hidden');
		   	  		}else{
		   	  			$('.one').removeClass('mui-hidden');
		   	  		}
		   	  	}
		   	  },function(type,xhr){
		   	  	alert(type.status)
		   	  })
			mui('.mui-content').on('tap','.applyPerson',function(){
				openWindow('applyPerson.html');
			})
				// 图片预览
	mui('#porel').on('tap','img', function() {
		$('.presee').removeClass('mui-hidden');
		var index = $(this).index();
		toverticalcenter();
		var gallery = mui('#slider');
		gallery.slider({
			interval: 0
		}).gotoItem(index);
	})
	function toverticalcenter() {
		var item = $('.preimg')
		var len = item.length;
		for (var i = 0; i < len; i++) {
			var t = ($(window).height() - item.eq(i).height()) / 2
			item.eq(i).css('top', t)
		}
	}
		$('.presee').on('tap', function() {
			$(this).addClass('mui-hidden')
		})
})
	</script>
</html>

