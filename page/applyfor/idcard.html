<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="../../css/mui.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/share_main.css" />
		<link rel="stylesheet" href="apply.css" />
		<script src="../../js/mui.js"></script>
	</head>
	<body>
		<div class="apply_mark">
			<div class="apply_popover">
				<img src="../../img/cbd.jpg" class="case_show" alt="" />
			</div>
		</div>
		<div class="nation_content">
			<!--实例蒙版-->

			<header class="mui-bar mui-bar-nav nav_header">
				<img src="../../img/left.png" alt="" class="header_left_img mui-action-back" />
				<span>Certificate Authentication</span>
			</header>
			<div class="mui-content ">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="apply_idCard">
							<div class="apply_idcard_div">
								<div class="img_div">
									<img src="../../img/case.png" alt="" class="case" name="one" />
									<span>case</span>
								</div>
								<div class="apply_idpho photo_" name="one">
									<img src="" class="one id_imgcover" />
									<img src="../../img/camera.png" class="id_img" alt="" />
									<p>Holding Certificate For Obverse</p>
									<p class="text">[holding certificate nearer to the front of the camera, filming the chest above. fous the certificate above fonts and pictures clearly visible]</p>
								</div>  
							</div>
							<div class="apply_idcard_div">
								<div class="img_div">
									<img src="../../img/case.png" alt="" class="case" name="two" />
									<span>case</span>
								</div>
								<div class="apply_idpho photo_" name="two">
									<img src="" alt="" class="two id_imgcover" />
									<img src="../../img/camera.png" class="id_img" alt="" />
									<p>Holding Certificate For Obverse</p>
									<p class="text">[holding certificate nearer to the front of the camera, filming the chest above. fous the certificate above fonts and pictures clearly visible]</p>
								</div>
							</div>
							<div class="apply_idcard_div deal_marb">
								<div class="img_div">
									<img src="../../img/case.png" class="case" alt="" name="three" />
									<span>case</span>
								</div>
								<div class="apply_idpho photo_" name="three">
									<img src="" alt="" class="three id_imgcover" />
									<img src="../../img/camera.png" class="id_img" alt="" />
									<p>Holding Certificate For Obverse</p>
									<p class="text">[holding certificate nearer to the front of the camera, filming the chest above. fous the certificate above fonts and pictures clearly visible]</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="mui-popover  mui-popover-action mui-popover-bottom" id="photo">
			<ul class="mui-table-view">
				<li class="mui-table-view-cell" id="bycamera">照相</li>
				<li class="mui-table-view-cell" id="bygallary">相册</li>
			</ul>
			<ul class="mui-table-view">
				<a href="#photo"><li class="mui-table-view-cell"><b>取消</b></li></a>
			</ul>
		</div>
		<footer class="mui-bar mui-bar-footer">
			<button class="nav_footer mui-btn id_button" >  
				<span>Done</span>
			</button>
		</footer>
	</body>
	<script src="../../js/jquery.min.js"></script>
	<script src="../../js/comment.js"></script>
	<script src="../../js/utils.js"></script>
	</body>
	<script>
		$('.apply_mark').on('tap', function() {
			$(this).css('display', 'none');
			$('.deal_marb').addClass('nation_marb');
		})
		 $('.case').on('tap', function() {
			var ca = $(this).attr('name');
			var a_src = $("." + ca).attr('src');
			$('.apply_mark').css('display', 'block');
			$('.deal_marb').removeClass('nation_marb');
			if (a_src) {
				$('.case_show').attr('src', a_src);
			} else {
				$('.case_show').attr('src', "../../img/cbd.jpg");
			}
		})
		 mui.plusReady(function() {
			plus.webview.currentWebview().setStyle({
				scrollIndicator: 'none'
			});
			var fo='';
			mui('.mui-scroll-wrapper').scroll();
			$('.photo_').on('tap', function() {
				fo=$(this).attr('name');
				mui('#photo').popover('toggle');
			})
			//选择照片
			$('#bycamera').on('tap',function(){
				bycamera();
				mui('#photo').popover('toggle');
			})
			$('#bygallary').on('tap',function(){
				bygallery();
				mui('#photo').popover('toggle');
			})
			function bycamera(context) {
				var camera = plus.camera.getCamera();
				var res = camera.supportedImageResolutions[0];
				var fmt = camera.supportedImageFormats[0];
				var _this = context;
				camera.captureImage(function(path) {
					dealpic(path, _this);
				})
			}
			function dealpic(path, context) {
					plus.io.resolveLocalFileSystemURL(path, function(entry) {
						var local = entry.toLocalURL();
						path = plus.io.convertLocalFileSystemURL(path);
						$("." + fo).attr('src', path).css('display', 'block');
						dealImage(local, {
							width: 17 * 4,
							quality: 1
						}, function(base) {
							console.log("压缩后：" + base.length * 0.8 / 1024 + "KB");
							data = {
								imgName: Math.floor(Math.random() * 100000) + ".jpg",
								imgData: base // base字符串
							}
							myAjax({
									url: "common/file/imgUp",
									data: data
								},
								function(obj) {
									if (obj.ret == 1) {
										$("." + fo).attr('src', path).css('display', 'block');
										if (fo == "one") {
											plus.storage.setItem('nation_pic1', JSON.stringify(obj.res.fid));
										} else if (fo == "two") {
											plus.storage.setItem('nation_pic2', JSON.stringify(obj.res.fid));
										} else if (fo == "three") {
											plus.storage.setItem('nation_pic3', JSON.stringify(obj.res.fid));
										}
									} else {
										mui.toast('请先登录在操作！');
									}
								},
								function(xhr, type) {
									console.log(xhr.status);
								}, function() {
									alert("qingdenglu")
								})
						})
					})
				}
				//bg galary

			function bygallery(context) {
				plus.gallery.pick(function(path) {
					dealpic(path, context);
				}, function(e) {
					mui.toast('选择图片失败' + e)
					showobj(e)
				}, {
					filter: 'image',
					multiple: false
				})
			}
			var flag = true;
			var add_data;

			function checke() {
				//获取前后页面的值
				var data_first = plus.storage.getItem('nation_data1');
				var data_one = JSON.parse(data_first); //转换成对象  
				if (true) {
					var pic1 = plus.storage.getItem('nation_pic1');
					var pic2 = plus.storage.getItem('nation_pic2');
					var pic3 = plus.storage.getItem('nation_pic3');
					if (!pic1) {
						mui.toast('请完成手持证件照照片');
						flag = false;
						return;
					}
					if (!pic2) {
						mui.toast('请完成证件的正面照片');
						flag = false;
						return;
					}
					if (!pic3) {
						mui.toast('请完成证件的反面照片');
						flag = false;
						return;
					}
				}
				data_2 = {
					cardPic1: pic1,
					cardPic2: pic2,
					cardPic3: pic3
				}
				var  add_data = $.extend(data_one, data_2); //将前后对象进行合并  
				if (flag) {
					myAjax({
						url: "account/applyDeliver",  
						data: add_data
					}, function(obj) {
						if (obj.ret == 1) {
							plus.storage.removeItem('nation_data1');
							plus.storage.removeItem('nation_pic1');
							plus.storage.removeItem('nation_pic2');
							plus.storage.removeItem('nation_pic3');
							openWindow("submitted.html");
						} else if (obj.ret == 2) {
							mui.toast('你已申请,请勿重复申请！');
							plus.storage.removeItem('nation_pic1');
							plus.storage.removeItem('nation_pic2');  
							plus.storage.removeItem('nation_pic3');
						} else {
							alert(obj.ret );
						}
					}, function(xhr, type) {
						console.log(xhr.status);
					})
				}
			}
			$('.id_button').on('tap', function() {
				checke();
			})
		});
	</script>

</html>
