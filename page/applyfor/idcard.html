<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title></title>
<script src="../../js/mui.js"></script>

<link href="../../css/mui.css" rel="stylesheet"/>
<link rel="stylesheet" href="apply.css" />
<style>
.apply_padding{
		margin: 0 .2em;
	}
.apply_mark{
	display: none;
	z-index: 998;
/*	overflow-y: none;*/
	position: absolute;
	background: rgba(0, 0, 0, .5);
	top: 0;
	left: 0;  
	right: 0;
	bottom: 0;
}
.apply_popover{
	width: 80%;
	height: 20em;
	position: absolute;
	left:50%;
	margin-left: -40%;
	top:50%; 
	margin-top: -10em;
	overflow: hidden; 
	border: 1px solid white;
}
.apply_popover img{
	z-index: 999;
	width: 100%;
	height: 20em;
}
.spplay_select_type{
	width: 80%;
	position: absolute;
	left: 50%;
    margin-left:-44%;
	display: none;
	color: white;
	overflow: hidden;
} 
.spplay_select_type ul{
	list-style: none;
}
.spplay_select_type li{
	width: 100%;
	height: 48px;
	margin: 0 auto;
	background-color: white;
	color: silver;
	margin-top: .1em;
	line-height: 48px;
	text-align: center;
}
.nation_content{
	width:100% ;
	height: 100%;
	overflow: hidden;
}
</style>
</head>
	<body>
	<div class="apply_mark">
		<div class="apply_popover">
			<img src="../../img/cbd.jpg" class="case_show" alt="" />
		</div>
	</div>
		<div class="nation_content">
	<!--实例蒙版-->
	
	<header class="mui-bar mui-bar-nav apply_header">
		<span class="mui-icon mui-icon-left-nav mui-action-back"></span>
		<span class="apply_title">Certificate Authentication</span>
	</header>
	<div class="mui-content ">
		<ul class="mui-table-view apply_padding" >
			<li class="mui-table-view-cell">
				<img src="../../img/id.png" class="mui-pull-left" alt="" />
				<img src="../../img/down.png" class="mui-pull-right" alt=""  id="select_type"/>
				<div class="apply_input_r">
					<input type="text" class="apply_input" placeholder="请选择证件" disabled="disabled" id="select_type_show"/>
				</div>
			</li>
			<li class="mui-table-view-cell">
				<img src="../../img/id.png" class="mui-pull-left" alt="" />
				<div class="apply_input_r">
					<input type="text" class="apply_input" placeholder="请输入对应的证件号" id="id_number"/>
				</div>
			</li>
			<div class="spplay_select_type">
				<ul class="id_type">
					<li>身份证</li>
					<li>军官证</li>
					<li>学生证</li>
					<li>驾照</li>
				</ul>
		    </div>
		</ul>
		  
		<div class="apply_idCard">
			<div class="apply_idcard_div">
				<img src="" alt="" class=""/>
				<div class="img_div"> 
					<img src="../../img/case.png" alt="" class="case" name="one"/>
					<span>case</span>
				</div>
				<div class="apply_idpho">
					<img  src="" class="one id_imgcover" />
					<img src="../../img/camera.png" class="photo_ one id_img" alt="" name="one"/>
					<p>Holding Certificate For Obverse</p>
					<p class="text">[holding certificate nearer to the front of the camera,
						 filming the chest above. fous the certificate above 
						 fonts and pictures clearly visible]</p>
				</div>
			</div>
			<div class="apply_idcard_div">
				<img src="" alt="" class=""/>
				<div class="img_div"> 
					<img src="../../img/case.png" alt="" class="case" name="two"/>
					<span>case</span>
				</div>
				<div class="apply_idpho">
					<img src="" alt="" class="two id_imgcover" />
					<img src="../../img/camera.png" class="photo_ id_img" alt="" name="two"/>
					<p>Holding Certificate For Obverse</p>
					<p class="text">[holding certificate nearer to the front of the camera,
						 filming the chest above. fous the certificate above 
						 fonts and pictures clearly visible]</p>
				</div>
			</div>
			<div class="apply_idcard_div nation_marb">
				<img src="" alt="" class=""  />
				<div class="img_div"> 
					<img src="../../img/case.png" class="case" alt="" name="three"/>
					<span>case</span>
				</div>
				<div class="apply_idpho">
					<img src="" alt="" class="three id_imgcover"/>
					<img src="../../img/camera.png" class="photo_ id_img" alt="" name="three"/>
					<p>Holding Certificate For Obverse</p>
					<p class="text">[holding certificate nearer to the front of the camera,
						 filming the chest above. fous the certificate above 
						 fonts and pictures clearly visible]</p>
				</div>
			</div>
		</div>       
   </div>
    <div class="apply_footer">
		<div class="id_button apply_button" ><span>Done</span></div>
	</div>
</div>
</body>
<script src="../../js/jquery.min.js"></script>
<script src="../../js/comment.js"></script>
<script src="../../js/utils.js"></script>
</body>
<script>	
        $('#select_type').on('tap',function(){
        	$('.spplay_select_type').css('display','block');
        })
        $('.spplay_select_type li').on('tap',function(){
        	$(this).css({'background-color':'silver','color':'white'})
        	.siblings().css({'background-color':'white','color':'silver'})
        	$('.spplay_select_type').css('display','none');
        	$('#select_type_show').val($(this).text());
        })
        $('.apply_mark').on('tap',function(){
        	$(this).css('display','none');  
        })
        $('.case').on('tap',function(){
        	var ca=$(this).attr('name');
        	var a_src=$("."+ca).attr('src');
        	$('.apply_mark').css('display','block');
        	if(a_src){$('.case_show').attr('src',a_src);}
        	
        })
		mui.plusReady(function(){ 
			plus.webview.currentWebview().setStyle({scrollIndicator:'none'});
					     	    var iw;
					     	    var fo
			$('.photo_').on('tap', function() { 
			   fo=$(this).attr('name');   
				var _this = this;
				iw = $(this).outerWidth()
				var btnArray = [{
					title: "拍照"
				}, {
					title: "相册"
				}];
				plus.nativeUI.actionSheet({
					title: "选择照片",
					cancel: "取消",
					buttons: btnArray
				}, function(e) {  
					var index = e.index;
					if (index == 1) {
						bycamera(_this);
					} else if (index == 2) {
						bygallery(_this);
					} else if (index == 0) {
						return;
					}
				});
			})
			function bycamera(context) {
				var camera = plus.camera.getCamera();
				var res = camera.supportedImageResolutions[0];
				var fmt = camera.supportedImageFormats[0];
				var _this = context;
				camera.captureImage(function(path) {
					dealpic(path, _this);
                     path=plus.io.convertLocalFileSystemURL(path);
                     $("."+fo).attr('src',path).css('display','block');
				})
			}
			function dealpic(path, context) {
				plus.io.resolveLocalFileSystemURL(path, function(entry) {
					var local = entry.toLocalURL();
					
					dealImage(local, {
						width: 17 * 4,
						quality: 0.5
					}, function(base) {
						console.log("压缩后：" + base.length * 0.8 / 1024 + "KB");
						data={
								imgName: Math.floor(Math.random() * 100000) + ".jpg",
								imgData: base // base字符串
							}
						myAjax({url:"common/file/imgUp",data:data},
							function(data){
								console.log(data.ret);
								if(data.ret==1){
									if(fo=="one"){
										plus.storage.setItem('nation_pic1',JSON.stringify(data.res.fid))
									}else if(fo=="two"){
										plus.storage.setItem('nation_pic2',JSON.stringify(data.res.fid))
									}else if(fo=="three"){
										plus.storage.setItem('nation_pic3',JSON.stringify(data.res.fid))
									}
									  
								}
							},
							function(xhr,type){
								console.log(xhr.status);
						},function(){
							alert("qingdenglu")
						})
						
					})
				})  
			}
			//bg galary
			function bygallery(context) {
				plus.gallery.pick(function(path) {
					
					dealpic(path, context);
					$("."+fo).attr('src',path).css('display','block');
				}, function(e) {
					mui.toast('选择图片失败' + e)
					showobj(e)
				}, {
					filter: 'image',
					multiple: false
				})
			} 
			var flag=true;
			var id_type_name="";//证件类型
			$('.id_type li').on('tap',function(){
				var id_number=$(this).index();
				if(id_number==0){
					id_type_name="身份证";
				}else if(id_number==1){
					id_type_name="军官证";
				}else if(id_number==2){
					id_type_name="学生证";
				}else if(id_number==3){
					id_type_name="驾照";
				}
			});
			 var add_data;
	function checke(){
			//获取前后页面的值
			var data_1=plus.storage.getItem('nation_data1');
			var data_obg1=JSON.parse(data_1);
			var id_nu=$('#id_number').val().trim();

			if(true){
			var pic1=plus.storage.getItem('nation_pic1');
			var pic2=plus.storage.getItem('nation_pic2');
			var pic3=plus.storage.getItem('nation_pic3');
				if(!id_type_name){
					mui.toast('请先选择证件类型！');
					flag=false;
					return;
				}
				if(!id_nu){
					mui.toast('请输入证件号码！');
					flag=false;
					return;
				}
				if(!pic1){
					mui.toast('请完成手持证件照照片');
					flag=false;
					return;
				}
				if(!pic2){
					mui.toast('请完成证件的正面照片');
					flag=false;
					return;
				}
				if(!pic3){
					mui.toast('请完成证件的反面照片');
					flag=false;
					return;
				}
			   
			
			}  
			data_2={    
				cardPic1:pic1,  
				cardPic2:pic2,
				cardPic3:pic3,
				idType:id_type_name,
				creditCard:id_nu
			}
   		     add_data=$.extend({},data_obg1,data_2);    
   		     alert(1111);
	        if(flag){  
			   myAjax({url:"account/applyDeliver",data:add_data},function(obj){
			   	     if(obj.ret==1){
			   	     	alert('请等待审核！');
			   	     	plus.storage.removeItem('nation_data1');
			   	     	plus.storage.removeItem('nation_data1');
						plus.storage.removeItem('nation_pic1');
						plus.storage.removeItem('nation_pic2');
						plus.storage.removeItem('nation_pic3');
			   	        openWindow("../../new_index.html"); 
			   	     }else if(obj.ret==2){
			   	     	mui.toast('提交失败');
			   	     }  
		   },function(xhr,type){   
		   	 console.log(xhr.status);  
		   }  
		)}           
	}
		$('.id_button').on('tap',function(){
	         	checke();
		})           
});  

    </script>
</html>
