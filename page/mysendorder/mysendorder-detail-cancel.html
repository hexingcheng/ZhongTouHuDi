<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <link href="../../css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="mysendorder-comment.css"/>
    <link rel="stylesheet" href="mysendorder-detail.css"/>
    <script src="../../js/mui.min.js"></script>
    
</head>
<body style="background: #fff;">
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">Detail</h1>
	</header>
	
	<div class="mui-content">
		<div id="scroll-wrapper" class="mui-scroll-wrapper">
			<div class="mui-scroll">
				<ul class="mui-table-view mui-grid-view mui-grid-9">
					<li class="mui-table-view-cell mui-col-xs-12">
						<span class="mui-pull-left title-color mui-text-left name">Name</span>
						<span class="mui-pull-right mui-text-right mui-ellipsis goods-name">--</span>
					</li>
					<li class="mui-table-view-cell mui-col-xs-6">
						<span class="mui-pull-left title-color mui-text-left title-padded">Reward</span>
						<span class="mui-pull-right">
							<div class="goods-value-box">
								<span class="value-color">$</span><span id="goods-value" class="value-color value-size">0.00</span>
								<p class="title-color">not paid</p>
							</div>
						</span>
					</li>
					<li class="mui-table-view-cell mui-col-xs-6">
						<span class="mui-pull-left title-color mui-text-left title-padded">Weight</span>
						<span id="goods-weight" class="mui-pull-right title-weight">0kg</span>
					</li>
					<li class="mui-table-view-cell mui-col-xs-6">
						<div class="title-color title-bottom-padded">Get Time</div>
						<div id="get-time">--:--</div>
					</li>
					<li class="mui-table-view-cell mui-col-xs-6">
						<div class="title-color title-bottom-padded">Deadline</div>
						<div id="deadline">--:--</div>
					</li>
				</ul>
				
				<div class="table-diviver"></div>
				
				<ul class="mui-table-view">
					<li class="mui-table-view-cell desc-after">
						<span class="title-color mui-pull-left title-width">Host</span>
						<span id="host" class="mui-ellipsis content-length">--</span>
					</li>
					<li class="mui-table-view-cell desc-after">
						<span class="title-color mui-pull-left title-width">From</span>
						<span id="sendaddr" class="mui-ellipsis content-length">--</span>
					</li>
					<li class="mui-table-view-cell desc-after">
						<span class="title-color mui-pull-left title-width">TO</span>
						<span id="receiveaddr" class="mui-ellipsis content-length">--</span>
					</li>
					<li class="mui-table-view-cell desc-after">
						<span class="title-color mui-pull-left title-width">Value</span>
						<span id="gvalue" class="mui-ellipsis content-length">--</span>
					</li>
					<li class="mui-table-view-cell desc-after">
						<span class="title-color mui-pull-left title-width">Desc</span>
						<span id="info" class="mui-ellipsis content-length">--</span>
					</li>
					<li class="mui-table-view-cell desc-after">
						<div class="porel">
							<span class="img-box">
								<span class="mui-icon mui-icon-plusempty"></span>
							</span>
							<span class="img-box">
								<span class="mui-icon mui-icon-plusempty"></span>
							</span>
							<span class="img-box">
								<span class="mui-icon mui-icon-plusempty"></span>
							</span>
							<span class="img-box">
								<span class="mui-icon mui-icon-plusempty"></span>
							</span>
							<!--<span class="img-box">
								<img src="../../img/2147de349744915c611f470c84c67f94.jpg" width="100%"/>
							</span>-->
						</div>
					</li>
				</ul>
			</div>
		</div>
	</div>
	
	<footer style="height: 3.2em;" class="mui-bar mui-bar-footer mui-text-center bg-color">
		<button id="edit-btn" class="mui-btn button-first">edit</button>
		<button id="resend-btn" class="mui-btn button-next">resend</button>
	</footer>

	<!-- 加载中的蒙层 -->
	<!--<div id="loading-mask"></div>
	<div id="loading-box">
		<img src="../../img/loading45.gif" alt="loading"/>
	</div>-->
	<script src="../../js/jquery.min.js" ></script>
	<script src="../../js/utils.js"></script>
	
	<script type="text/javascript">
		mui.init();
		mui.plusReady(function(){
			mui("#scroll-wrapper").scroll();
			
			var orderid = plus.storage.getItem("my-send-order");
			sendmsg(orderid);
			
			// 获取当前page
			var cpage = plus.webview.currentWebview();
			// 重新编辑
			document.getElementById("edit-btn").addEventListener("tap", function(){
				mui.openWindow({
					url : "../sendorder/createorder.html",
					id : "createorder",
					extras : {
						orderId : orderid
					},
					show : {
						aniShow : "slide-in-left",
						duration : 200
					},
					waiting : {
						autoShow : true,
						title : "正在加载...",
						options : {
							background: '#d1d1d1'
						}
					}
				})
				setTimeout(function(){
					cpage.close("none", 0)
				}, 300)
			})
			
			// 重新发布
			document.getElementById("resend-btn").addEventListener("tap", function(){
				mui.ajax(BASEURL + "order/release", {
					data : {
						orderId : orderid
					},
					type : "post",
					success : function(data){
						alert(data.ret);					// 404错误，不能找到路由路径
						/*if(data.ret == 1){
							mui.toast("发布成功")
							mui.openWindow({
								url : "./my-send-order.html",
								id : "my-send-order",
								createNew : true,
								waiting : {
									autoShow : true,
									title : "正在加载...",
									options : {
										background: '#d1d1d1'
									}
								}
							})
							setTimeout(function(){
								cpage.close("none", 0)
							}, 200)
						}*/
					},
					error : function(xhr, type){
						console.log(xhr.status);
					}
				})
			}, false)
			
			
			
			
			
		})
		
		// 发送消息显示页面信息
		function sendmsg(orderid){
				// 页面加载时，获取数据
	      	mui.ajax(BASEURL + "order/goodShow", {
	      		data : {
	      			orderId : orderid,
	      			type : "send"
	      		},
	      		type : "post",
	      		success : function(data){
	      			console.log(JSON.stringify(data));
	      			
	      			if(data.ret == 1){
	      				$(".goods-name").html(data.res.gName);		// 货物名称
		      			$("#goods-value").html(data.res.money);		// 价值
		      			$("#goods-weight").html(data.res.gWeight+ "kg");	// 重量
		      			$("#get-time").html(data.res.getTime);		// 获取时间
		      			$("#deadline").html(data.res.finTime);		// 期望时间
		      			$("#sendaddr").html(data.res.sendAddr);		// 发送地
		      			$("#receiveaddr").html(data.res.receiveAddr)	// 接收地
		      			$("#gvalue").html(data.res.gValue);		// value
		      			$("#info").html(data.res.info);		// 信息描述
		      			var pic = data.res.pics;
		      			
		      			var n = BASEURL.indexOf('/api/');
		      			
						var per = BASEURL.substring(0,n);
						var len = pic.length;
						if(len > 0){
							for(var i = 0; i<len;i++){
								var url = per + pic[i].path;
								var html = '<img src=' + url +' width="100%">';
								document.querySelectorAll(".img-box")[i].innerHTML = html;
							}
						}
						
						// 判断是否在议价,显示议价消息链接框
						if(data.res.bargain == 1){
							$("#msg-warn").css("display", "block")
						} else {
							$("#msg-warn").css("display", "none")
						}
						
						/*// 300毫秒之后清除等待框
		      			setTimeout(function(){
		      				var lmask = document.getElementById("loading-mask");
		      				var lbox = document.getElementById("loading-box");
		      				var mcl = lmask.classList;
		      				var bcl = lbox.classList;
		      				mcl.add("fade-out");
		      				bcl.add("fade-out");
		      				// 过渡动画结束的时候执行该事件
		      				lmask.addEventListener("webkitTransitionEnd", function(){
			      				document.getElementById("loading-mask").style.display = "none";
			      				document.getElementById("loading-box").style.display = "none";
			      				mcl.remove("fade-out");
		      					bcl.remove("fade-out");
		      				}, false)
		      			}, 300)*/
	      			}
	      		},
	      		error : function(xhr, type){
	      			console.log(type);
	      		}
	      	})
		}
	</script>
</body>
</html>
