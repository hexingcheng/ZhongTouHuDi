<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <link href="../../css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="mysendorder-comment.css"/>
    <link rel="stylesheet" href="mysendorder-detail.css"/>
    <script src="../../js/mui.min.js"></script>
    <style type="text/css">
    	.headimg-box {width: 4em;height: 4em;border-radius: 50%;overflow: hidden;margin: 0 auto;}
    	#deliverer-img {padding: 11px 0;}
    	#deliverer-msg {padding: 13px 0 22px 10px;color: #333;}
    	.deliverer-name {font-size: 1.1em;padding: 5px 0;}
    	.deliverer-honor {color: #8c8c8c;}
    	#deliverer-num {padding: 0 0 22px 0;}
    	.send-title {padding: 15px 0 10px 0;color: #8c8c8c;}
    	.send-num {font-size: 1.2em;color: #7f7f7f;}
    	.mui-icon.mui-icon-chatbubble-filled {color: #ffc11b;}
    	.mui-icon.mui-icon-phone-filled {color: #00b94e;}
    	#deliverer-contact {padding: 0;}
    	#deliverer-contact div {padding: 10px 0;}
    	#deliverer-contact div:nth-child(1) {border-bottom: 1px solid #eee;}
    </style>
</head>
<body style="background: #fff;">
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">Detail</h1>
	</header>
	
	<div class="mui-content">
		<div id="scroll-wrapper" class="mui-scroll-wrapper">
			<div class="mui-scroll">
				<ul class="mui-table-view mui-grid-view mui-grid-9">
					<!-- 第一列显示信息start -->
					<li id="deliverer-img" class="mui-table-view-cell mui-ellipsis mui-col-xs-3">
						<div class="headimg-box">
							<img id="head-img" alt="头像" src="../../img/u=2205791892,1328528914&fm=21&gp=0.jpg" width="100%"/>
						</div>
					</li>
					<li id="deliverer-msg" class="mui-table-view-cell mui-col-xs-5">
						<div id="nickName" class="deliverer-name mui-text-left mui-ellipsis">匿名</div>
						<div class="deliverer-honor mui-text-left">
							<span style="color: #faf713;" class="mui-icon mui-icon-starhalf"></span>
							<span id="ptitle">平民等级</span>
						</div>
					</li>
					<li id="deliverer-num" class="mui-table-view-cell mui-col-xs-2">
						<div class="send-title">send</div>
						<div id="orderCount" class="send-num">0</div>
					</li>
					<li id="deliverer-contact" class="mui-table-view-cell mui-col-xs-2">
						<div ><span class="mui-icon mui-icon-chatbubble-filled"></span></div>
						<div><span id="phone" data-phone="" class="mui-icon mui-icon-phone-filled"></span></div>
					</li>
					<!-- 第一列信息显示end -->
					
					<li class="mui-table-view-cell mui-col-xs-12">
						<span class="mui-pull-left title-color mui-text-left name">Name</span>
						<span class="mui-pull-right mui-text-right mui-ellipsis goods-name">--</span>
					</li>
					<li class="mui-table-view-cell mui-col-xs-6">
						<span class="mui-pull-left title-color mui-text-left title-padded">Reward</span>
						<span class="mui-pull-right">
							<div class="goods-value-box">
								<span class="value-color">$</span><span id="goods-value" class="value-color value-size">0.00</span>
								<p class="title-color">paided</p>
							</div>
						</span>
					</li>
					<li class="mui-table-view-cell mui-col-xs-6">
						<span class="mui-pull-left title-color mui-text-left title-padded">Weight</span>
						<span id="goods-weight" class="mui-pull-right title-weight">0kg</span>
					</li>
					<li class="mui-table-view-cell mui-col-xs-6">
						<div class="title-color title-bottom-padded">Get Time</div>
						<div id="get-time">--:--</div>
					</li>
					<li class="mui-table-view-cell mui-col-xs-6">
						<div class="title-color title-bottom-padded">Deadline</div>
						<div id="deadline">--:--</div>
					</li>
				</ul>
				
				<div class="table-diviver"></div>
				
				<ul class="mui-table-view">
					<li class="mui-table-view-cell desc-after">
						<span class="title-color mui-pull-left title-width">Host</span>
						<span id="host" class="mui-ellipsis content-length">--</span>
					</li>
					<li class="mui-table-view-cell desc-after">
						<span class="title-color mui-pull-left title-width">From</span>
						<span id="sendaddr" class="mui-ellipsis content-length">--</span>
					</li>
					<li class="mui-table-view-cell desc-after">
						<span class="title-color mui-pull-left title-width">TO</span>
						<span id="receiveaddr" class="mui-ellipsis content-length">--</span>
					</li>
					<li class="mui-table-view-cell desc-after">
						<span class="title-color mui-pull-left title-width">Value</span>
						<span id="gvalue" class="mui-ellipsis content-length">--</span>
					</li>
					<li class="mui-table-view-cell desc-after">
						<span class="title-color mui-pull-left title-width">Desc</span>
						<span id="info" class="mui-ellipsis content-length">--</span>
					</li>
					<li class="mui-table-view-cell desc-after">
						<div class="porel">
							<span class="img-box">
								<span class="mui-icon mui-icon-plusempty"></span>
							</span>
							<span class="img-box">
								<span class="mui-icon mui-icon-plusempty"></span>
							</span>
							<span class="img-box">
								<span class="mui-icon mui-icon-plusempty"></span>
							</span>
							<span class="img-box">
								<span class="mui-icon mui-icon-plusempty"></span>
							</span>
							<!--<span class="img-box">
								<img src="../../img/2147de349744915c611f470c84c67f94.jpg" width="100%"/>
							</span>-->
						</div>
					</li>
				</ul>
			</div>
		</div>
	</div>
	
	<footer id="footer-cancel" style="height: 3.2em;" class="mui-bar mui-bar-footer mui-text-center bg-color">
		<button id="comment-order" class="mui-btn mui-btn-block">comment</button>
	</footer>

	<!-- 加载中的蒙层 -->
	<div id="loading-mask"></div>
	<div id="loading-box">
		<img src="../../img/loading45.gif" alt="loading"/>
	</div>
	
	<script src="../../js/jquery.min.js" ></script>
	<script src="../../js/utils.js"></script>
	
	<script type="text/javascript">
		mui.init();
		mui.plusReady(function(){
			mui("#scroll-wrapper").scroll();
			var orderid = plus.storage.getItem("my-send-order");
			
			// 显示详情页面信息
			sendmsg(orderid);
			
			// 订单评价
			document.getElementById("comment-order").addEventListener("tap", function(){
				openWindow("./order-comment.html");
			}, false);
		})
		
		
		// 通过订单号获取数据
		function sendmsg(orderid){
				// 页面加载时，获取数据
	      	mui.ajax(BASEURL + "order/goodShow", {
	      		data : {
	      			orderId : orderid,
	      			type : "send"
	      		},
	      		type : "post",
	      		success : function(data){
//	      			console.log(JSON.stringify(data));
	      			if(data.ret == 1){
	      				$(".goods-name").html(data.res.gName);		// 货物名称
		      			$("#goods-value").html(data.res.money);		// 价值
		      			$("#goods-weight").html(data.res.gWeight+ "kg");	// 重量
		      			$("#get-time").html(data.res.getTime);		// 获取时间
		      			$("#deadline").html(data.res.finTime);		// 期望时间
		      			$("#host").html(data.res.sender);			// 发送者
						$("#sendaddr").html(data.res.sendAddr);		// 发送地
		      			$("#receiveaddr").html(data.res.receiveAddr)	// 接收地
		      			$("#gvalue").html(data.res.gValue);		// value
		      			$("#info").html(data.res.info);		// 信息描述
		      			var pic = data.res.pics;
		      			
		      			// sender 递送人信息显示
		      			if(data.res.deliver.headPic){		// 头像显示
		      				$("#head-img").attr("src", data.res.deliver.headPic);
		      			}
		      			if(data.res.deliver.nickName){		// 昵称
		      				$("#nickName").html(data.res.deliver.nickName);
		      			}
		      			if(data.res.deliver.ptitle){		// 等级
		      				$("#ptitle").html(data.res.deliver.ptitle);
		      			}
		      			if(data.res.deliver.orderCount){		// 接单数量
		      				$("#orderCount").html(data.res.deliver.orderCount);
		      			}
		      			if(data.res.deliver.phone){		// 电话号码
		      				$("#pnone").attr("data-phone", data.res.deliver.phone);
		      			}
		      			
		      			
		      			var n = BASEURL.indexOf('/api/');
		      			
						var per = BASEURL.substring(0,n);
						var len = pic.length;
						if(len > 0){
							for(var i = 0; i<len;i++){
								var url = per + pic[i].path;
								var html = '<img src=' + url +' width="100%">';
								document.querySelectorAll(".img-box")[i].innerHTML = html;
							}
						}
						
						// 验证是否需要取消按钮
						if(data.res.status == 6){
							$("#footer-cancel").css("display", "none")
							$(".mui-scroll-wrapper").css("bottom", 0)
						}
						
						
						// 300毫秒之后清除等待框
		      			setTimeout(function(){
		      				var lmask = document.getElementById("loading-mask");
		      				var lbox = document.getElementById("loading-box");
		      				var mcl = lmask.classList;
		      				var bcl = lbox.classList;
		      				mcl.add("fade-out");
		      				bcl.add("fade-out");
		      				// 过渡动画结束的时候执行该事件
		      				lmask.addEventListener("webkitTransitionEnd", function(){
			      				document.getElementById("loading-mask").style.display = "none";
			      				document.getElementById("loading-box").style.display = "none";
			      				mcl.remove("fade-out");
		      					bcl.remove("fade-out");
		      				}, false)
		      			}, 300)
	      			}
	      		},
	      		error : function(xhr, type){
	      			console.log(type);
	      		}
	     	})    
	    }
		
	</script>
</body>
</html>
