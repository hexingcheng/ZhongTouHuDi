<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <link href="../../css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="mysendorder-comment.css"/>
    <link rel="stylesheet" href="../../fonts/iconfont-star.css"/>
    <script src="../../js/mui.min.js"></script>
    <style type="text/css">
    	.mui-btn.mui-btn-block {background: #054859;}
    	.mui-content-padded {color: #999;}
    	.title {color: #999;}
    	.g-name {color: #cfd1d2;padding-left: 0.5em;}
    	.icon-font {color: #31a25f;}
    	.mui-input-row label {padding: 0px 15px;height: 100%;line-height: 2.5;}
    	.gName {width: 65%;height: 100%;line-height: 2.5;padding-left: 1em;}
    	.mui-input-group .mui-input-row {height: auto;}
    	.mui-input-group .mui-input-row:first-child {padding: 5px 0;}
    	.mui-input-group .mui-input-row:after {right: 15px;height: 5px;}
    	.mui-input-group .mui-input-row:nth-child(2):after {height: 0px;}
    	.mui-content-padded {margin: 10px 10px 10px 30px;}
    	.enter-words {padding: 2px 5px 5px 0;color: #bec0c2;}
    	.mui-card {box-shadow: 2px 2px 6px rgba(200,200,200,.6);margin-bottom: 1em; border-radius: 5px;}
    	.mui-table-view:before, .mui-table-view:after, .mui-table-view-cell:after {height: 0;}
    	#delivery-speed {padding: 5px 10px;color: #5f5d5d;font-size: 14px;font-weight: bold;}
    	#delive-speed, #delive-service {color: #31a25f;padding: 15px 0;}
    	.mui-table-view-cell.mui-col-xs-7 {padding: 11px 3px !important;}
    	.iconfont {color: #3fc776;font-size: 1.7em;font-weight: bold;float: left;padding-right: 10px;}
    	.not-active {color: #fff; text-shadow: -1px -1px 3px #d3d4d5;}
    	.mui-bar-nav~.mui-content {padding-bottom: 3.2em;}
    </style>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">Order Comment</h1>
	</header>
	
	<div class="mui-content">
		<div class="mui-content-padded">Description evalution</div>
		<div class="mui-card">
			<div class="mui-input-group">
				<div class="mui-input-row">
					<label>
						<span class="mui-icon mui-icon-pengyouquan icon-font"></span>
						<span class="g-name">Name</span>
					</label>
					<div class="mui-pull-left gName mui-ellipsis">Flower</div>
				</div>
				<div class="mui-input-row">
					<div class="">
						<textarea id="info" maxlength="100" rows="5" placeholder="Please write down your comment..."></textarea>
					</div>
				</div>
				<div class="mui-input-row enter-words mui-text-right">
					can accommodate <span id="words">100</span> words
				</div>
			</div>
		</div>
		<ul class="mui-table-view mui-grid-view mui-grid-9">
			<li class="mui-table-view-cell mui-col-xs-12 mui-text-left">
				<div class="title">Qualitative evalution</div>
			</li>
			<li id="delivery-speed" class="mui-table-view-cell mui-col-xs-3 delivery-speed">Delivery speed</li>
			<li id="delivery" class="mui-table-view-cell mui-col-xs-7">
				<i data-index="1" class="iconfont icon-xingxing01 "></i>
				<i data-index="2" class="iconfont icon-xingxing01 not-active"></i>
				<i data-index="3" class="iconfont icon-xingxing01 not-active"></i>
				<i data-index="4" class="iconfont icon-xingxing01 not-active"></i>
				<i data-index="5" class="iconfont icon-xingxing01 not-active"></i>
			</li>
			<li id="delive-speed" class="mui-table-view-cell mui-col-xs-2">slow</li> 
		</ul>
	</div>
	
	<footer id="footer-cancel" style="height: 3.2em;" class="mui-bar mui-bar-footer mui-text-center bg-color">
		<button id="comment-order" class="mui-btn mui-btn-block">comment</button>
	</footer>
	<script src="../../js/utils.js"></script>
    <script>
      	mui.init();
      	mui.plusReady(function(){
      		plus.webview.currentWebview().setStyle({
      			scrollIndicator : "none"
      		})
      		// 默认为两星
      		var delivery = 1;
      		
      		// 星星评价
      		var pin = document.getElementById("delive-speed");
      		mui("#delivery").on("tap", ".iconfont", function(){
      			var index = this.getAttribute("data-index");		// 当前点击的index值
      			var type = this.getAttribute("data-type");			// 获取当前点击类型
      			var child = this.parentNode.children;		// 获取当前节点下所有节点包括自己
      			// 清理当前点击的样式呈现
      			for(var i = 0; i < index; i++){
      				var cls = child[i].classList;
      				if(cls.contains("not-active")){
      					cls.remove("not-active");
      				}
      			}
      			// 添加店家后面样式的清空
      			for(var j = index; j < 5; j++){
      				var cls = child[j].classList;
      				if(!cls.contains("not-active")){
      					cls.add("not-active");
      				}
      			}
      			// 分数评价
      			delivery = index;
      			pin.innerHTML = index == 1 ? "bad" : index == 2 ? "slow" : index == 3 ? "genral" : index == 4 ? "well" : "very"; 
      		})
      		
      		// 对评价按钮的添加事件		bad slow genral well very well
      		var finish = plus.webview.getWebviewById("mysendorder-detail-finish");
      		var cpage = plus.webview.currentWebview();
      		document.getElementById("comment-order").addEventListener("tap", function(){
      			var inf = document.getElementById("info").value.trim();
      			if(inf){
	      			var datas = {
	      				orderId : plus.storage.getItem("my-send-order"),
	      				info : inf,
	      				score : delivery
	      			}
	      			
	      			// ajax发送数据
	      			mui.ajax(BASEURL + "order/evaluate", {
						data : datas,
						type : "post",
						success : function(data){
							if(data.ret == 1){
								mui.toast("评价成功");
								openNewWindow("./my-send-order.html");
								setTimeout(function(){
									plus.webview.close(finish, "fade-out", 200)
									plus.webview.close(cpage, "fade-out", 200)
								}, 300)
							} else {
								alert("不能重复评论");
							}
						},
						error : function(xhr, type){
							console.log(type)
						}
					})
      			} else {
      				mui.toast("未填写评价信息")
      			}
      		})
      		
      	})
    </script>
</body>
</html>