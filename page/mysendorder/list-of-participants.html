<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <link href="../../css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="mysendorder-comment.css"/>
    <script src="../../js/mui.min.js"></script>
    <style type="text/css">
    	.mui-table-view-cell {padding: 0.6em 0;}
    	.mui-table-view-cell:nth-child(2n) {background: #f5f5f5;}
    	.img-row {width: 20%;}
    	.headimg-box {width: 3.2em;height: 3.2em;border-radius: 50%;overflow: hidden;margin: 0 auto;}
    	.name-box {width: 30%;padding: 3px 0 0 0;}
    	.order-send {width: 12%;padding: 3px 0 0 0;}
    	.order-send .send-num {color: #646464;}
    	.order-reward {width: 14%;padding: 3px 0 0 0;}
    	.order-reward .reward-money {color: #d92400;}
    	.button-box {width: 24%;padding: 10px 0 0 0;}
    	.mui-scroll-wrapper {top: 44px;}
    </style>
</head>
<body style="background: #fff;">
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">list of participants</h1>
	</header>
	<div class="mui-content">
		<div id="scroll-wrapper" class="mui-scroll-wrapper">
			<div class="mui-scroll">
				<ul id="choose-sender" class="mui-table-view">
					<!--<li class="mui-table-view-cell">
						<div class="img-row mui-pull-left">
							<div class="headimg-box">
								<img src="../../img/u=2205791892,1328528914&fm=21&gp=0.jpg" width="100%"/>
							</div>
						</div>
						<div class="name-box mui-pull-left mui-text-center">
							<div class="deliverer-name mui-text-left mui-ellipsis">Justin Bieber</div>
							<div class="deliverer-honor mui-text-left">
								<span style="color: #faf713;" class="mui-icon mui-icon-starhalf"></span>
								<span class="mui-h5">Adminral</span>
							</div>
						</div>
						<div class="order-send mui-pull-left mui-text-center">
							<p>send</p>
							<div class="send-num">37</div>
						</div>
						<div class="order-reward mui-pull-left mui-text-center">
							<p>reward</p>
							<div class="reward-money">15.0</div>
						</div>
						<div class="button-box mui-pull-left mui-text-center">
							<button class="mui-btn-green mui-btn choose-item" type="button">choose</button>
						</div>
					</li>-->
					
				</ul>
			</div>
		</div>
	</div>
	<script src="../../js/template.js"></script>
	<script src="../../js/utils.js"></script>
	<script id="template" type="text/html">
		<!-- 选择按钮上，添加一个属性节点data-senderid -->
		{{each list}}
			<li class="mui-table-view-cell">
				<div class="img-row mui-pull-left">
					<div class="headimg-box" data-uid="{{$value.uid}}">
						{{if $value.headPic == ""}}
							<img alt="headpicture" src="../../img/u=2205791892,1328528914&fm=21&gp=0.jpg" width="100%"/>
						{{else}}
							<img alt="headpicture" src="{{$value.headPic}}" width="100%"/>
						{{/if}}
					</div>
				</div>
				<div class="name-box mui-pull-left mui-text-center">
					{{if $value.realName == ""}}
						<div class="deliverer-name mui-text-left mui-ellipsis">匿名</div>
					{{else}}
						<div class="deliverer-name mui-text-left mui-ellipsis">{{$value.realName}}</div>
					{{/if}}
					<div class="deliverer-honor mui-text-left">
						<span style="color: #faf713;" class="mui-icon mui-icon-starhalf"></span>
						{{if $value.ptitle == ""}}
							<span class="mui-h5">平民等级</span>
						{{else}}
							<span class="mui-h5">{{$value.ptitle}}</span>
						{{/if}}
					</div>
				</div>
				<div class="order-send mui-pull-left mui-text-center">
					<p>send</p>
					<div class="send-num">{{$value.deliverCount}}</div>
				</div>
				<div class="order-reward mui-pull-left mui-text-center">
					<p>reward</p>
					<div class="reward-money">{{$value.money}}</div>
				</div>
				<div class="button-box mui-pull-left mui-text-center">
					<button data-uid="{{$value.uid}}" class="mui-btn-green mui-btn choose-item" type="button">choose</button>
				</div>
			</li>
		{{/each}}
	</script>
	<script>
      	mui.init();
      	mui.plusReady(function(){
      		mui("#scroll-wrapper").scroll();
      		
      		var orderid = plus.storage.getItem("my-send-order");
//    		console.log(orderid);
      		sendmsg({
      			page : 1,
      			pageSize : 10,
      			orderId : orderid
      		})
      		plus.nativeUI.closeWaiting();
      		
      		// 添加选择该递送人
      		var cpage = plus.webview.currentWebview();
      		mui("#choose-sender").on("tap", ".choose-item", function(){
      			var datas = {
      				uid : this.getAttribute("data-uid"),
      				orderId : orderid
      			}
      			mui.ajax(BASEURL + "order/bargainConfirm", {
      				data : datas,
      				type : "post",
      				success : function(data){
      					if(data.ret == 1){
      						mui.toast("选择递送人成功");
      						mui.openWindow({
      							url : "./my-send-order.html",
      							id : "my-send-order",
      							createNew : true,
      							show : {
									aniShow : "slide-in-left",
									duration : 200
								},
								waiting : {
									autoShow : true,
									title : "正在加载...",
									options : {
										background: '#d1d1d1'
									}
								}
      						})
      						setTimeout(function(){
      							cpage.close("none", 0);
      						}, 300)
      					} else if (data.ret == 2) {
      						mui.toast("非法操作");
      					} else if (data.ret == 3){
      						mui.toast("订单已接单");
      					}
      				}
      			})
      		})
      		
      		// 查看用户信息
      		mui("#choose-sender").on("tap", ".headimg-box", function(){
      			var ud = this.getAttribute("data-uid");
      			console.log(ud);
      			openWindow("../person/myinfo.html", {
      				uid : ud
      			})
      		})
      		
      		
      	})
      	
      	function sendmsg(datas){
      		mui.ajax(BASEURL + "order/bargainList", {
      			data : datas,
      			type : "post",
      			success : function(data){
      				console.log(JSON.stringify(data));
					var obj = {
						list : data.res
					}
					var html = template("template", obj);
					document.getElementById("choose-sender").innerHTML = html;
      			},
      			error : function(xhr, type){
      				console.log(type);
      			}
      		})
      	}
      	
    </script>
	
</body>
</html>