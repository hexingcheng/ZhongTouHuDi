<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="../../js/mui.min.js"></script>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style>
			.mui-bar {
				background-color: #3ba767;
			}
			.mui-bar h1,
			.mui-bar a {
				color: #FFFFFF;
			}
			html,
			body,
			.mui-content,
			.hand-map {
				background-color: #FFFFFF;
				width: 100%;
			}
			.hand-map {
				position: absolute;
				top: 44px;
				padding: 5px;
				z-index: 10000;
			}
			.hand-detial {
				border: 1px solid #e3e3e3;
			}
			.fl {
				float: left;
			}
			.fr {
				float: right;
			}
			.clear {
				zoom: 1;
			}
			.clear:after {
				content: "";
				display: block;
				clear: both;
			}
			.wid15 {
				width: 15%;
			}
			.wid85 {
				width: 85%;
			}
			.sear .mui-input-clear,
			.smap .mui-input-clear {
				margin: 0;
				padding: 0;
				height: 39px;
				border: 0;
				width: 100%;
			}
			.hei60 {
				height: 40px;
			}
			.addbor {
				border-bottom: 1px solid #e3e3e3;
			}
			.linehei40 {
				line-height: 40px;
			}
			html,
			body,
			.mui-content {
				height: 100%;
			}
			.map {
				width: 100%;
				height: 100%;
			}
			#footer {
				height: 60px;
				background-color: #FFFFFF;
				padding: 10px 20px;
			}
			.ok {
				float: left;
				width: 48%;
				margin-right: 2%;
				text-align: center;
				line-height: 40px;
				background-color: #23A0CF;
				color: #e8fff3;
			}
			.cancel {
				text-align: center;
				line-height: 40px;
				float: left;
				width: 48%;
				margin-left: 2%;
				background-color: #ff8474;
				color: #fce7e4;
			}
			#chooseaddr {
				line-height: 40px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">Trip plan</h1>
		</header>
	</body>
	<footer class="mui-bar mui-bar-footer" id="footer">
		<div class="ok" id="ok">ok</div>
		<div class="cancel">cancel</div>
	</footer>
	<div class="mui-content">
		<div class="hand-map">
			<div class="hand-detial">
				<div class="clear sear">
					<div class="fl wid15 hei60 mui-text-center"><span class="mui-icon mui-icon-search linehei40"></span></div>
					<div class="fl wid85 hei60 addbor">
						<div id="chooseaddr">查询地址中....</div>
					</div>
				</div>
				<div class="clear smap">
					<div class="fl wid15 hei60 mui-text-center"><span class="mui-icon mui-icon-map linehei40"></span></div>
					<div class="fl wid85 hei60">
						<div class="mui-input-row">
							<input placeholder="detail address" class="mui-input-clear" type="text" id="detail">
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="map" id="map-canvas">

		</div>
	</div>
	<script type="text/javascript" src="../../js/jquery.min.js"></script>
	<script src="../../js/utils.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbxX3v0OCgYabsgQcUjrQlF4rGhlL7-2Y&v=3.exp&language=zh-CN&signed_in=true&libraries=places"></script>
	<script type="text/javascript" charset="utf-8">
		mui.init();
		var mymap
		function initialize(lat, lng) {
			mymap = new google.maps.Map(document.getElementById('map-canvas'), {
				zoom: 17,
				center: {
					lat: lat,
					lng: lng
				}
			});
			var marker = new google.maps.Marker({
				map: mymap,
				position: mymap.getCenter()
			});
			var geocoder = new google.maps.Geocoder;
			geocodeLatLng(geocoder, mymap, lat, lng)
		}

		function geocodeLatLng(geocoder, map, lat, lng) {
			var latlng = {
				lat: lat,
				lng: lng
			};
			geocoder.geocode({
				'location': latlng
			}, function(results, status) {
				if (status === google.maps.GeocoderStatus.OK) {
					if (results[1]) {
						$('#chooseaddr').text(results[1].formatted_address)
					} else {
						alert('No results found');
					}
				} else {
					window.alert('Geocoder failed due to: ' + status);
				}
			});
		}
		mui.plusReady(function() {
			var clocation;
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(function(position) {
					showobj(position.coords)
					var lat = position.coords.latitude;
					var lng = position.coords.longitude;
					initialize(lat, lng)
				}, function(e) {
					mui.toast('获取位置信息失败')
				}, {
					enableHighAcuracy: true
				})
			} else {
				mui.toast('获取位置信息失败')
			}
			document.getElementById('chooseaddr').addEventListener('tap', function() {
				openWindow('./chooseaddr.html');
			})
			document.getElementById('ok').addEventListener('tap', function() {
				var myaddr = $('#chooseaddr').text() + $("#detail").val();
				var nextcreate = plus.webview.getWebviewById('create-next');
				mui.fire(nextcreate, 'getaddrs', {
					"addrs": myaddr,
					"mylocation":clocation
				});
				plus.webview.currentWebview().close();
				nextcreate.show('slide-in-left');
			})
			window.addEventListener('getaddr', function(eve) {
				var addr = eve.detail.addr;
				$('#chooseaddr').text(addr);
				clocation = eve.detail.clocation;
				mymap.setCenter(clocation);
      			mymap.setZoom(17)
			})
		})
	</script>

</html>