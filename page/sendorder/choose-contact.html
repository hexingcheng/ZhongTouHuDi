<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="common.css"/>
		<style type="text/css">
			.mui-bar {background-color: #3ba767;}
			.mui-bar h1,.mui-bar a {color: #FFF;}
			#done.btn-disabled {color: #ccc;}
			.tel-name {width: 60%;padding-top: 2px;}
			.tel-num {width: 40%;padding-top: 3px;}
		</style>
	</head>

	<body>

		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">contacts</h1>
			<a id='done' class="mui-btn mui-btn-link mui-pull-right">完成</a>
		</header>
		
		<div class="mui-content">
			<div class="">
				<!--<div class="mui-content-padded">常用联系人</div>
				<div id="usual-contact-list" class="mui-input-group"></div>-->
				<div class="mui-content-padded">选择联系人</div>
				<div id="contact-list" class="mui-input-group">
					<!--<div class="mui-input-row mui-radio mui-left">
						<label>
							<span class="mui-pull-left mui-ellipsis tel-name">李鑫其</span>
							<span class="tel-num mui-pull-right mui-ellipsis mui-h5 mui-text-right">18584654947</span>
						</label>
						<input name="style" type="radio" checked value="">
					</div>-->
					
				</div>
			</div>
		</div>
		
		<script type="text/html" id="template">
			{{each list}}
				<div class="mui-input-row mui-radio mui-left contact" data-name='{{$value.name}}' data-contact='{{$value.contact}}'>
					<label>
						<span class="mui-pull-left mui-ellipsis tel-name">{{$value.name}}</span>
						<span class="tel-num mui-pull-right mui-ellipsis mui-h5 mui-text-right">{{$value.contact}}</span>
					</label>
					<input name="style" type="radio" value="">
				</div>
			{{/each}}
		</script>
		
		<script src="../../js/mui.min.js"></script>
		<!--<script src="../../js/mui.indexedlist.js"></script>-->
		<script src="../../js/utils.js"></script>
		<script src="../../js/template.js"></script>
		<!--<script src="../../js/jquery.min.js"></script>-->
		<script>
			mui.init();
			
			mui.plusReady(function(){
				var contact = JSON.parse(plus.storage.getItem("contacts"));
				var obj = {
					list : contact
				}
				var html = template("template", obj);
				document.getElementById("contact-list").innerHTML = html;
				
				var val = {}
				mui("#contact-list").on("tap", ".contact", function(){
					val = {};	// 清空数据
					val.name = this.getAttribute("data-name");
					val.tel = this.getAttribute("data-contact");
				})
				
				// 联系人选择列表
				var type = getstorage("order-type");
				var cpage = plus.webview.currentWebview();
				var opener = plus.webview.currentWebview().opener();
				document.getElementById("done").addEventListener("tap", function(){
					if(Boolean(val.name && val.tel)){
						if(type == "sender"){
							plus.storage.removeItem("order-type");
							mui.fire(opener, "order:sender", val);
						} else if(type == "receiver"){
							plus.storage.removeItem("order-type");
							mui.fire(opener, "order:receiver", val);
						}
						plus.webview.show(opener, "slide-in-left", 200);
						setTimeout(function(){
							plus.webview.close(cpage, "none", 0)
						}, 210)
						plus.storage.removeItem("order-type");
					} else {
						mui.toast("请选择联系人");
					}

				}, false)
				
			})
		</script>

	</body>

</html>