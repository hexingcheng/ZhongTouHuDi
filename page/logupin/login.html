<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="../../js/mui.js"></script>
		<link href="../../css/mui.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/main.css" />
		<link rel="stylesheet" href="../../css/cy_log_up.css" />
		<script type="text/javascript" charset="utf-8">
			mui.init();
		</script>
		<style type="text/css">
		html,body{
			width: 100%;
			height: 100%;
		}
		.tips{
			width: 100%;
			position: absolute;
			left: 0;
			z-index: 11;
			height: 100%;
			background-color: rgba(0,0,0,0.2);
			color: #FFFFFF;
			padding-top: 50%;
			font-size: 30px;
			text-align: center;
		}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav hea_bg">
			<a class="mui-icon mui-icon-left-nav color_w mui-action-back"></a>
			<h1 class="mui-title color_w">Welcome</h1>
		</header>
		<footer class="mui-bar mui-bar-footer  none_box">
			<div class="log_button color_w" id="submit-button">Logon</div>
		</footer>
		<div class="mui-content bg">
			<!--log框-->
			<div class="w_log ">
				<div class="log_img">
					<img src="../../img/log.png" />
					<span style="color: #06495A;"> <b>Along</b></span>
				</div>
			</div>               
			<!--输入框-->
			<div class="log_contain bg_w">
				<div class="log_input ">
					<img src="../../img/pho.png" alt="" />
					<input type="text" class="log_input_" id="signup-phone-number" placeholder="phone number" />
				</div>
				<div class="log_clear">
					<!--中间间隙-->
				</div>
				<div class="log_input">
					<img src="../../img/valcode.png" alt="" />
					<input type="text" class="log_input_" placeholder="password" id="signup-phone-password" />
				</div>
			</div>
			<div class="log_span">
				<span class="color">forget password ? <a href="findpassword.html" class="log_color">click me</a>
				<span class="mui-pull-right me_color"> <a href="productName.html">log in</a></span>
				</span>
			</div>
		</div>
		<script src="../../js/utils.js"></script>
		<script type="text/javascript" src="../../js/jquery.min.js" ></script>
		<script type="text/javascript">
			mui.plusReady(function() {
				var reph = /^[0-9]{6,12}$/;
				var repw = /^[\\.a-zA-Z0-9_]{6}$/;

				function checkLogin() {
					var pho = document.getElementById('signup-phone-number');
					var phonenum = pho.value.trim();
					var pass = document.getElementById('signup-phone-password');
					var pwd = pass.value.trim();
					var flag = true;
					if (pwd && phonenum) {
						if (!reph.test(phonenum)) {
							flag = false;
							mui.toast("请确定手机号码输入");
						}
						if (!repw.test(pwd)) {
							flag = false;
							mui.toast("请确定密码输入格式正确");
							pass.value = "";
						}
					} else {
						mui.toast("请填入登录信息");
					}
					// 判断输入是否正确
					if (flag) {
						plus.nativeUI.showWaiting('登录中')
						var data = {
								phone: phonenum,
								pwd: pwd,
								type: 1
							}
							//		  					var obj = getuserbasicinfo();
						data.mac = plus.device.imei;
						data.imsi = plus.device.imsi;
						data.systemName = plus.device.vendor
						data.systemVersion = plus.device.model;
						pho.value = "";
						pass.value = "";
						// 登录时发送的ajax请求
						mui.ajax(BASEURL + "auth/login", { // 后台交互数据			登录
							type: "post",
							data: data,
							success: function(obj) { // 成功的时候，根据不同的状态回应不同的相应信息给客户端
								$('.tips').addClass('mui-hidden')
								if (obj.ret == 0) {
									mui.toast("输入异常");
								} else if (obj.ret = 1) {
									//注册成功
									plus.nativeUI.closeWaiting();
									getacountinfo()
									setstorage('token', obj.token);
									plus.webview.currentWebview().close();
									plus.webview.getLaunchWebview().show('slide-in-left');
								} else if (obj.ret == -1) {
									mui.toast("手机号或密码错误")
								} else if (obj.ret == -2) {
									mui.toast("账户已冻结")
								} else if (obj.ret == -3) {
									mui.toast("验证次数太多稍后再试")
								}
							},
							error: function(xhr, type, errorThrown) {
								console.log(type);
								errorhandle(type)
							}
						})
					}
				}
				function getacountinfo(){
					mui.ajax(BASEURL+'account/info',{
						type:'post',
						success:function(data){
							if(data.ret==1){
								mui.toast('获取初始账户信息成功');
								var i = plus.webview.getLaunchWebview();
								mui.fire(i,'setaccount',data.res);
							}
						},
						error:function(xhr,type){
							console.log(type)
						}
					})
				}
				var submits = document.getElementById('submit-button')
				submits.addEventListener('tap', function() {
					checkLogin();
				});
			});
		</script>
	</body>

</html>