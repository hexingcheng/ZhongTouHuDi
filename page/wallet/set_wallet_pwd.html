<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <link href="../../css/mui.min.css" rel="stylesheet"/>
    <script src="../../js/mui.min.js"></script>
    <style>
    body{
    	background-color: #fff;
    }
    	.header{
    		height: 52px;
    		line-height:52px;
    		color: #fff;
    		font-size: 16px;
    		padding-top: 0;
    		padding-bottom: 0;
    		box-shadow: none !important;  
    		background-color: #44AB6E;
    	}
    	.header img{
    		width: 34px;
    		height: 34px;
    		margin: 9px 9px 9px 0;
    		float: left;
    		
    	}
    	.set_wallet_pwd  li{
    		height: 50px;
    		line-height: 50px;
    		font-size: 14px;
    		padding-top: 0;
    		padding-bottom: 0;
    		
    	}
    	.set_wallet_pwd img{
    		width: 34px;
    		height: 34px;
    		margin: 8px 8px 8px 0;
    		float: left;
    	}
    	.set_wallet_title{
    		line-height: 23px !important;
    		font-size: 14px;
    	}
    	.set_pwd_input{
    		overflow: hidden;
    		height: 50px;
    		
    	}
    	.set_pwd_input input{
    		width: 100%;
    		height: 50px;
    		font-size: 14px;
    		border: 0;
    		margin-bottom: 0;
    	}
    	.forgat_pwd{
    		font-size: 14px;
    		line-height: 40px;
    		color: #44AB6E;
    		margin-right: 15px;
    	}
    	.set_button{
    		width: 80%;
    		height: 48px;
    		line-height: 48px;
    		text-align: center;
    		font-size: 16px;
    		color: #fff;
    		left: 50%;
    		margin-left: -40%;
    		position: absolute;
    		bottom:0;
    		background-color: #054859;
    	}
    	.second_show{
    		display: none;
    	}
    </style>
</head>
<body >
	<header class="mui-bar mui-bar-nav header">
		<img src="../../img/left.png" alt=""  class="mui-action-back"/>
		<span>Set the wallet password</span>
	</header>
	<div class="mui-content set_wallet_pwd ">
		<ul class="mui-table-view ">
			<li class="mui-table-view-cell set_wallet_title">
				<img src="../../img/wallet3.png" alt="" />
				<span style="color: #F5D63F;">Set wallet password</span>
				<p><span>please input your pay password</span></p>
			</li>
		</ul>
		<ul class="mui-table-view">
			<li class="mui-table-view-cell mui-text-center">
				<span >你正在为<span>xxx</span>账号设置密码</span>
			</li>
			<li class="mui-table-view-cell second_show">
				<img src="../../img/payWord1.png" alt="" />
				<div class="set_pwd_input">
					<input type="password" placeholder="oldpassword" id="old_pwd"/>
				</div>
			</li>
			<li class="mui-table-view-cell">
				<img src="../../img/payWord1.png" alt="" />
				<div class="set_pwd_input">
					<input type="password" placeholder="password" id="pwd"/>
				</div>
			</li>
			<li class="mui-table-view-cell">
				<img src="../../img/payWord1.png" alt="" />
				<div class="set_pwd_input">
					<input type="password" placeholder="comfirm password" id="comf_pwd"/>
				</div>
			</li>
		</ul>
			<span class="mui-pull-right forgat_pwd second_show"  >Forgot Your Password</span>
	</div>
	<footer>
		<div class="set_button" id="submit">确定</div>  
	</footer>
</body>
<script src="../../js/utils.js"></script>
<script src="../../js/jquery.min.js"></script>
<script>
	mui.plusReady(function(){ 
		var pay_pwd=JSON.parse(getstorage('personinfo')); 
		alert(JSON.stringify(pay_pwd))
			if(pay_pwd.setpay==0){ 
				$('.second_show').css('display','none');
			}else{
				$('.second_show').css('display','block');
			}   
	function check(){
		//支付密码修改
		
		var pwd=$('#pwd').val().trim();
		var flag=true;
		var old_pwd=$('#old_pwd').val().trim();
		var pwd=$('#pwd').val().trim();
		var comf_pwd=$('#comf_pwd').val().trim();
		    if(pay_pwd.setpay==0){
		    	
		    	if(!pwd){
		    		mui.toast('请输入新密码');
		    		flag=false;
		    		return;
		    	}
		    	if(!comf_pwd){
		    		mui.toast('请输入确认密码');
		    		flag=false;    
		    		return;
		    	}
		    	
		    	if(!(pwd==comf_pwd)){
			    		mui.toast('确认密码有误，请重新输入');
			    		flag=false;  
			    		$('#comf_pwd').val('');
			    		return;
			    	
		    	}
		    }else if(pay_pwd.setpay==1){
		    	if(!old_pwd){
		    		mui.toast('请输入旧密码');
		    		flag=false;
		    		return;
		    	}
		    	if(!pwd){
		    		mui.toast('请输入新密码');
		    		flag=false;
		    		return;
		    	}
		    	if(!comf_pwd){
		    		mui.toast('请输入确认密码');
		    		flag=false;
		    		return;
		    	}
		    	if(!(pwd==comf_pwd)){
		    		mui.toast('确认密码有误，请重新输入');
		    		flag=false;
		    		$('#comf_pwd').val('');  
		    	}
		    }
		
		  	if(flag){
			data={newPwd:pwd,oldPwd:old_pwd} 
			myAjax({url:'account/setPayPwd',data:data},function(obj){
				alert(JSON.stringify(obj)+'cycycy');
				if(obj.ret==1){
					mui.toast('成功'); 
						$('.second_show').css('display','block');
						$('#pwd').val('');
						$('#comf_pwd').val('');
						pay_pwd.setpay=1;
						plus.storage.removeItem('personinfo');
						setstorage('personinfo',JSON.stringify(pay_pwd));
					openWindow('.')
				}else if(obj.res==2){
					mui.toast('老密码验证错误');  
				}
			},function(xhr,type){
				mui.toast(type.satus);
			});
  		}
	}
	$('#submit').on('tap',function(){  
		check(); 
	})
})
</script>
</html>














