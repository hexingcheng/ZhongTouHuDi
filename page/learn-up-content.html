<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="../js/mui.min.js"></script>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<script type="text/javascript" charset="utf-8">
			mui.init();
		</script>
		<style>
		html,body,.mui-content{
			background-color: #FFFFFF;
		}
			.handle {
				padding: 20px 25px;
			}
			.handle span {
				color: red;
			}
			.addpad {
				height: 50px;
				line-height: 50px;
			}
			.userpic {
				width: 50px;
				height: 50px;
			}
			.icon {
				font-size: 35px;
				display: inline-block;
				text-align: center;
				width: 100%;
				height: 100%;
				line-height: 1.5;
			}
			.color-change {
				color: #d1d1d1;
				font-size: 14px;
				margin-left: 30px;
			}
			.mui-table-view-cell .change-size {
				border: 0;
				height: auto;
				margin: 0;
				padding: 0;
				font-size: 15px;
			}
			.mui-input-group:before,
			.mui-input-group:after {
				background-color: #ffffff;
			}
			.mui-input-group label {
				font-size: 14px;
			}
			.pic-tips{
				padding: 20px 15px;
			}
			.mui-btn-block{
				width: 70%;
				margin: 30px auto 30px;
				padding: 5px 0;
			}
			#take-photo {
				width: 3em;
				height: 3em;
				background: #ccc;
				border-radius: 50%;
				overflow: hidden;
			}
			.take-photo {
				width: 50%;
				margin: 0 auto;
			}
			.take-icon {
				padding: 0.5em;
				font-size: 2em;
				background: #ccc;
				border-radius: 50%;
				overflow: hidden;
				cursor: pointer;
			}
			div.taken-img {
				width: 10em;
				height: 8.2em;
				overflow: hidden;
			}
		</style>
	</head>
	<body>
		<div class="mui-content">
			<div class="handle">
				<p><span href="" class="learn-online">①在线学习>></span><span href="" class="learn-up">②提交审核资料</span></p>
			</div>
			<ul class="mui-table-view mui-table-view-chevron">
				<li class="mui-table-view-cell  mui-media">
					<a href="#">
						<span class="mui-pull-left addpad">免冠半身照:</span>
						<div id="take-photo" class="mui-pull-right">
							<span class="mui-icon mui-icon-camera mui-pull-right icon head-img"></span>
							<!--<img class="userpic mui-pull-right" src="../img/user.png" />-->
						</div>
					</a>
				</li>
				<li class="mui-table-view-divider"></li>
				<form class="mui-input-group" id="form-commit">
					<div class="mui-input-row">
						<label>国籍:</label>
						<select name="country" class="" id="country">
							<option value="中国">中国</option>
							<option value="美国">美国</option>
							<option value="加拿大">加拿大</option>
							<option value="法国">法国</option>
							<option value="土耳其">土耳其</option>
						</select>
					</div>
					<div class="mui-input-row" >
						<label>所在地区:</label>
						<select name="privence" id="privence" class="">
							<option value="成都">成都</option>
							<option value="重庆">重庆</option>
							<option value="北京">北京</option>
							<option value="上海">上海</option>
							<option value="杭州">杭州</option>
						</select>
					</div>
					<div class="mui-input-row">
						<label>可接件区域:</label>
						<select class="" name="city" id="city">
							<option value="南充">南充</option>
							<option value="绵阳">绵阳</option>
							<option value="泸州">泸州</option>
							<option value="巴中">巴中</option>
							<option value="攀枝花">攀枝花</option>
						</select>
					</div>
					<div class="mui-input-row">
						<label>真实姓名:</label>
						<input type="text" name="name" class="mui-input-clear" placeholder="请输入真实姓名">
					</div>
					<div class="mui-input-row">
						<label>身份证号码:</label>
						<input type="text" name="idnumber" class="mui-input-clear" placeholder="请输入身份证号码">
					</div>
					<div class="mui-input-row">
						<label>紧急联络人:</label>
						<input type="text" name="contact" class="mui-input-clear" placeholder="请输入紧急联络人姓名">
					</div>
					<div class="mui-input-row">
						<label>联络人手机:</label>
						<input type="text" name="contactnumber" class="mui-input-clear" placeholder="请输入联络人手机">
					</div>
				</form>
			</ul>
			<div class="personal-info-pic">
				<p class="pic-tips">
					手持证件靠近镜头，正面拍摄胸部以上，对焦使证件上面字体和照片清晰可见。
				</p>
				<ul id="take-photos" class="mui-table-view mui-grid-view mui-grid-6">
					<li class="mui-table-view-cell mui-media mui-col-xs-6">
						<div data-index="cardPic1" class="take-photo">
							<span class="mui-icon mui-icon-camera take-icon"></span>
						</div>
						<!--<div class="taken-img">
							<img src="../img/details2.jpeg" />
						</div>-->
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-6">
						<div>
							<img src="../img/raw_1435154362.png" />
						</div>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-6">
						<div data-index="cardPic1" class="take-photo">
							<span class="mui-icon mui-icon-camera take-icon"></span>
						</div>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-6">
						<div>
							<img src="../img/raw_1435154402.png"/>
						</div>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-6">
						<div data-index="cardPic1" class="take-photo">
							<span class="mui-icon mui-icon-camera take-icon"></span>
						</div>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-6">
						<div>
							<img src="../img/raw_1435154483.png"/>
						</div>
					</li>
				</ul>
				<div class="mui-input-row mui-checkbox mui-left">
					<label>同意并接受<a>《服务平台使用规则》</a></label>
					<input name="checkbox" type="checkbox" checked>
				</div>
				<div class="mui-btn mui-btn-block" id="up-applay">立即提交</div>
			</div>
		</div>
		<script src="../js/jquery.min.js"></script>
		<script src="../js/comment.js"></script>
		<script>
			// 表单提交地址
			var formUrl = "http://202.202.43.107:8080/api/account/applyDeliver";
			// 图片提交地址
			var imgUrl = "http://202.202.43.107:8080/api/common/file/imgUp";
			
			mui.ready(function(){
				// 身份证验证图片发送
				mui("#take-photos").on("tap", ".take-photo", function(){
					var index = this.getAttribute("data-index")
					var _parent = this.parentNode;
					delPhotoMsg({
								width: 17 * 10, 
								quality: 0.5
							}, function(obj){
								_parent.innerHTML = '<div class="taken-img"><img src="'+ obj.now.base64Char +'" /></div>';
								sendImgData(imgUrl, obj, index);		// 调用函数发送信息
							})
				})
				
				// 免冠半身照图片发送
				mui("#take-photo").on("tap", ".head-img", function(){
					var _parent = this.parentNode;
					delPhotoMsg({
									width: 17 * 3, 
									quality: 0.5
								}, function(obj){
									_parent.innerHTML = '<img class="userpic mui-pull-right" src="'+ obj.now.base64Char +'" />';
									sendData("异步发送图片地址", obj);		// 调用函数发送信息
								})
				})
			
			
			// 提交申请快递人
			document.getElementById("up-applay").addEventListener("tap", function(){
				// 提交数据
				var err = validate();
				if(!err){
					var serilize = $("#form-commit").serialize();
					console.log(serilize)
				} else {
					mui.toast(err);
				}
			},false)
		})
		var da = {}
		// 验证后发送数据
		function sendData(){
			
		}

		// 发送数据函数
		function sendImgData(url, fileobj, index){
			console.log(url+"   " +fileobj.fileName + "  "+fileobj.now.base64Length)
			mui.ajax(url, {
				data : {
					imgName : fileobj.fileName,
					imgData : fileobj.now.base64Char,
					imgLength : fileobj.now.base64Length
				},
				type : "POST",
				success : function(data){
//					da[index] = data.res.fid;
					console.log(data.res.fid)
					console.log(da)			
				},
				error : function(xhr, type){
					console.log(type)
				}
			})
		}
		
		// 验证表单
		function validate(){
			var err = null;
			var repe = /^.{2,24}$/;			// 姓名匹配正则表达式
			var reph = /^[0-9]{6,12}$/;		// 电话号码验证表达式
			var rein = /^[0-9]{10,24}$/;	// 身份证验证正则表达式
			// 服务平台使用规则
			if(!$("[name='checkbox']").is(":checked")){
				err = "请同意服务平台使用规则";
			}
			
			// 紧急联系人号码
			var connum = $.trim($("[name='contactnumber']").val());
			if(!reph.test(connum)){
				err = "请输入紧急联系人的号码";
			}
			// 紧急联系人
			var contact = $.trim($("[name='contact']").val());
			if(!repe.test(contact)){
				err = "请输入紧急联系人";
			}
			// 身份证验证
			var idnum = $.trim($("[name='idnumber']").val());
			if(!rein.test(idnum)){
				err = "请输入正确的身份证号";
			}
			// 真实姓名验证
			var name = $.trim($("[name='name']").val());
			if(!repe.test(name)){
				err = "请输入您的真实姓名";
			}
			return err;
		}
		
		
		
		/*
		 	// 半身照验证
			if($("#take-photo").find("img").length == 0){
				err = "请拍照半身照验证";
			}
			// 验证是否拍照身份证验证
			var oimg = $(".take-photo");
			if(oimg.find("img").length != 3){
				err = "请完善拍照身份证验证";
			}
		 * */
		
		</script>
	</body>
</html>